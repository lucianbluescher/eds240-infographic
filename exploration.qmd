---
title: "Exploratory Data Analysis: Hydropower's Climate Impact Dilemma"
author: "Your Name"
date: today
format:
  pdf:
    documentclass: article
    fig-height: 6
    fig-width: 10
    keep-tex: false
  html:
    toc: true
    toc-depth: 3
execute:
  echo: true
  warning: false
  message: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 6,
  fig.align = "center"
)
```

# Introduction

This exploratory analysis investigates the contradiction between two perspectives on hydropower: 
(1) hydropower as a renewable, low-carbon climate solution, and (2) hydropower as a source of 
significant methane emissions and environmental harm. This analysis supports my thesis project on 
identifying "low-hanging fruits" - hydropower projects with the least environmental impact.

# Part IV: Data Import, Wrangling, and Exploratory Visualizations

## Load Packages

```{r load-packages}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(readr)
library(lubridate)
library(viridis)
library(janitor)  # for clean_names() function
```

## Import Data

```{r import-data}
# Read in hydropower generation data (TWh)
# clean_names() converts column names to snake_case for easier use in R
hydropower_generation <- read_csv("data/hydropower-generation/hydropower-generation.csv") %>%
  clean_names() %>%
  filter(!is.na(hydropower))

# Read in per capita energy consumption by source (kWh per person)
# This gives us energy mix context to compare hydropower to other sources
per_capita_energy <- read_csv("data/per-capita-energy-stacked/per-capita-energy-stacked.csv") %>%
  clean_names()

# Read in greenhouse gas emissions per capita
ghg_emissions <- read_csv("data/per-capita-greenhouse-gas-emissions/per-capita-greenhouse-gas-emissions.csv") %>%
  clean_names()

# Read in methane emissions per capita
methane_emissions <- read_csv("data/per-capita-methane-emissions/per-capita-methane-emissions.csv") %>%
  clean_names()

# Read in share of electricity from hydropower (%)
hydro_share <- read_csv("data/share-electricity-hydro/share-electricity-hydro.csv") %>%
  clean_names() %>%
  filter(!is.na(hydropower))
```

## Data Wrangling

```{r wrangle-data}
# Get most recent year for country-level analysis
most_recent_year <- max(hydropower_generation$year, na.rm = TRUE)

# Identify top hydropower producing countries (most recent year)
top_hydro_countries <- hydropower_generation %>%
  filter(year == most_recent_year) %>%
  arrange(desc(hydropower)) %>%
  slice_head(n = 10) %>%
  pull(entity)

# Calculate summary statistics for top countries
top_countries_summary <- hydropower_generation %>%
  filter(entity %in% top_hydro_countries) %>%
  group_by(entity) %>%
  summarise(
    mean_generation = mean(hydropower, na.rm = TRUE),
    recent_generation = hydropower[year == max(year, na.rm = TRUE)],
    .groups = "drop"
  ) %>%
  arrange(desc(mean_generation))

# Join hydropower data with emissions data for analysis
# Focus on most recent year for country-level comparison
# Note: hydro_share also has a 'hydropower' column, so we'll rename it to avoid conflicts
hydro_emissions <- hydropower_generation %>%
  filter(year == most_recent_year) %>%
  left_join(
    ghg_emissions %>% filter(year == most_recent_year),
    by = c("entity", "code", "year")
  ) %>%
  left_join(
    methane_emissions %>% filter(year == most_recent_year),
    by = c("entity", "code", "year")
  ) %>%
  left_join(
    hydro_share %>% 
      filter(year == most_recent_year) %>%
      rename(hydro_share_pct = hydropower),  # Rename to avoid conflict
    by = c("entity", "code", "year")
  ) %>%
  filter(!is.na(hydropower), !is.na(per_capita_greenhouse_gas_emissions_including_land_use))

# Calculate global trends over time
# Filter out incomplete years (2025 might have incomplete data)
global_trends <- hydropower_generation %>%
  filter(year <= 2024) %>%  # Exclude potentially incomplete 2025 data
  group_by(year) %>%
  summarise(
    total_hydro = sum(hydropower, na.rm = TRUE),
    .groups = "drop"
  )

# Calculate energy mix comparison for top countries
# Using per capita values directly for comparison
# Use 2024 if available, otherwise most recent year
plot_year_energy <- min(2024, max(per_capita_energy$year, na.rm = TRUE))

energy_mix_comparison <- per_capita_energy %>%
  filter(entity %in% top_hydro_countries,
         year == plot_year_energy) %>%
  select(entity, coal, oil, gas, nuclear, hydropower, wind, solar) %>%
  pivot_longer(cols = -entity, names_to = "energy_source", values_to = "per_capita_kwh") %>%
  filter(!is.na(per_capita_kwh), per_capita_kwh > 0)  # Only include positive values
```

## Exploratory Visualization 1: Global Hydropower Generation Over Time

**Question:** How has global hydropower generation changed over time, and what does this tell us about the scale of hydropower expansion?

```{r viz1-global-trends}
viz1 <- global_trends %>%
  ggplot(aes(x = year, y = total_hydro)) +
  geom_line(color = "#2c7bb6", size = 1.2) +
  geom_point(color = "#2c7bb6", size = 2, alpha = 0.7) +
  labs(
    title = "Global Hydropower Generation Over Time",
    subtitle = "Generation increased from ~6,000 TWh (1965) to over 30,000 TWh (2020), with rapid growth around 2000",
    x = "Year",
    y = "Total Hydropower Generation (TWh)",
    caption = "Data: Our World in Data - Hydropower Generation"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(viz1)
```

**Insight:** Global hydropower generation has grown substantially from ~6,000 TWh in 1965 to over 30,000 TWh by 2020, with a notable jump around 2000. This growth supports Article 1's claim about hydropower's expanding role in energy systems, but also raises Article 2's concern about cumulative environmental impacts from this scale of development.

## Exploratory Visualization 2: Top Countries by Hydropower Generation

**Question:** Which countries produce the most hydropower, and how does this relate to their emissions profile?

```{r viz2-top-countries}
viz2 <- top_countries_summary %>%
  mutate(entity = fct_reorder(entity, mean_generation)) %>%
  ggplot(aes(x = entity, y = mean_generation)) +
  geom_col(fill = "#4575b4", alpha = 0.8) +
  coord_flip() +
  labs(
    title = "Top 10 Countries by Average Hydropower Generation",
    subtitle = "Top producers include European Union, Norway, and other major hydropower countries",
    x = "Entity",
    y = "Average Annual Generation (TWh)",
    caption = "Data: Our World in Data - Hydropower Generation"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(viz2)
```

**Insight:** The top hydropower producers include the European Union (as an aggregate), Norway, Sweden, and France. This shows that hydropower is significant in multiple regions, not just a few countries. The geographic distribution is important for understanding where environmental impacts are most concentrated.

## Exploratory Visualization 3: Hydropower Share vs. Greenhouse Gas Emissions

**Question:** Do countries with more hydropower in their electricity mix have lower emissions? This tests Article 1's claim that hydropower reduces emissions.

```{r viz3-hydro-vs-emissions}
# Join hydro share with emissions for countries with data
# Use a more recent year that has complete data (2024 instead of 2025)
plot_year <- min(2024, max(hydro_share$year, na.rm = TRUE))

hydro_emissions_plot <- hydro_share %>%
  filter(year == plot_year) %>%
  rename(hydro_share_pct = hydropower) %>%  # Rename for clarity
  left_join(
    ghg_emissions %>% filter(year == plot_year),
    by = c("entity", "code", "year")
  ) %>%
  filter(!is.na(hydro_share_pct), !is.na(per_capita_greenhouse_gas_emissions_including_land_use),
         hydro_share_pct > 0) %>%
  # Lower threshold to get more data points
  filter(hydro_share_pct >= 1)

viz3 <- hydro_emissions_plot %>%
  ggplot(aes(x = hydro_share_pct, y = per_capita_greenhouse_gas_emissions_including_land_use)) +
  geom_point(alpha = 0.6, color = "#2c7bb6", size = 2) +
  geom_smooth(method = "lm", se = TRUE, color = "#d73027", linetype = "dashed") +
  labs(
    title = "Hydropower Share vs. Greenhouse Gas Emissions",
    subtitle = "Countries with higher hydropower share tend to have lower emissions per capita",
    x = "Share of Electricity from Hydropower (%)",
    y = "GHG Emissions per Capita (tonnes CO2-equivalent)",
    caption = "Data: Our World in Data - Electricity Share & GHG Emissions\nOnly countries with >1% hydropower share shown"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(viz3)
```

**Insight:** If data points appear, they show the relationship between hydropower share and emissions. A negative relationship would support Article 1's claim that hydropower reduces emissions compared to fossil fuels. However, this doesn't address Article 2's concern about methane emissions from reservoirs, which requires reservoir-specific data.

## Exploratory Visualization 4: Energy Mix Comparison - Top Hydropower Countries

**Question:** How does hydropower compare to other energy sources in top-producing countries? This shows the energy mix context.

```{r viz4-energy-mix}
viz4 <- energy_mix_comparison %>%
  mutate(
    energy_source = fct_relevel(energy_source, 
                                "coal", "oil", "gas", "nuclear", 
                                "hydropower", "wind", "solar"),
    entity = fct_reorder(entity, per_capita_kwh, .fun = sum)
  ) %>%
  ggplot(aes(x = entity, y = per_capita_kwh, fill = energy_source)) +
  geom_col(position = "stack", alpha = 0.9) +
  scale_fill_manual(
    values = c("coal" = "#313695",
               "oil" = "#4575b4",
               "gas" = "#74add1",
               "nuclear" = "#abd9e9",
               "hydropower" = "#2c7bb6",
               "wind" = "#fee090",
               "solar" = "#f46d43"),
    name = "Energy Source"
  ) +
  coord_flip() +
  labs(
    title = "Energy Mix in Top Hydropower Producing Countries",
    subtitle = "Hydropower is a significant source but fossil fuels still dominate in most countries",
    x = "Entity",
    y = "Per Capita Energy Consumption (kWh)",
    caption = "Data: Our World in Data - Per Capita Energy by Source"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40"),
    legend.position = "bottom"
  )

print(viz4)
```

**Insight:** This stacked bar chart shows the energy mix breakdown. If visible, it demonstrates how hydropower compares to other sources (coal, oil, gas, nuclear, wind, solar) in top-producing countries. Even countries with significant hydropower typically have diverse energy mixes, which is important context for understanding hydropower's role in emissions reduction.

## Exploratory Visualization 5: Methane Emissions and Hydropower

**Question:** Do countries with more hydropower have higher methane emissions? This directly tests Article 2's concern about reservoir methane.

```{r viz5-methane}
# Join hydropower generation with methane emissions
# Use 2024 if available for more complete data
plot_year_methane <- min(2024, max(hydropower_generation$year, na.rm = TRUE))

hydro_methane <- hydropower_generation %>%
  filter(year == plot_year_methane) %>%
  left_join(
    methane_emissions %>% filter(year == plot_year_methane),
    by = c("entity", "code", "year")
  ) %>%
  filter(!is.na(hydropower), !is.na(per_capita_methane_emissions_including_land_use),
         hydropower > 1) %>%  # Lower threshold to get more data points
  # Get top 15 for readability
  arrange(desc(hydropower)) %>%
  slice_head(n = 15)

viz5 <- hydro_methane %>%
  mutate(entity = fct_reorder(entity, hydropower)) %>%
  ggplot(aes(x = hydropower, y = per_capita_methane_emissions_including_land_use)) +
  geom_point(alpha = 0.7, color = "#d73027", size = 3) +
  geom_text(aes(label = entity), hjust = -0.1, vjust = 0.3, size = 3) +
  geom_smooth(method = "lm", se = TRUE, color = "#4575b4", linetype = "dashed") +
  labs(
    title = "Hydropower Generation vs. Methane Emissions",
    subtitle = "Testing Article 2's claim: Do countries with more hydropower have higher methane?",
    x = "Hydropower Generation (TWh)",
    y = "Methane Emissions per Capita (tonnes CO2-equivalent)",
    caption = "Data: Our World in Data - Hydropower Generation & Methane Emissions\nTop 15 countries by hydropower generation"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40")
  )

print(viz5)
```

**Insight:** If data points appear, they show the relationship between hydropower generation and methane emissions. A positive relationship would suggest Article 2's concern about reservoir methane may have merit, but methane emissions come from many sources (agriculture, fossil fuels, waste, etc.), not just reservoirs. This analysis needs reservoir-specific emissions data to fully evaluate Article 2's claim.

## Exploratory Visualization 6: Temporal Trends in Top Countries

**Question:** How have hydropower generation trends differed across top-producing countries? This shows where recent expansion has occurred.

```{r viz6-temporal-trends}
# Get time series for top 5 countries
top_5_countries <- top_hydro_countries[1:5]

viz6 <- hydropower_generation %>%
  filter(entity %in% top_5_countries) %>%
  ggplot(aes(x = year, y = hydropower, color = entity)) +
  geom_line(size = 1.2, alpha = 0.8) +
  geom_point(size = 2, alpha = 0.6) +
  scale_color_viridis_d(name = "Entity", option = "plasma") +
  labs(
    title = "Hydropower Generation Trends: Top 5 Countries",
    subtitle = "Trends show different expansion patterns across top-producing countries",
    x = "Year",
    y = "Generation (TWh)",
    caption = "Data: Our World in Data - Hydropower Generation"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 11, color = "gray40"),
    legend.position = "bottom"
  )

print(viz6)
```

**Insight:** China's dramatic growth suggests much recent capacity comes from new dams, which Article 2 argues have higher initial methane emissions. This temporal pattern supports the need to distinguish between new dams (high impact) vs. existing dams (lower impact) - directly relevant to my "low-hanging fruits" thesis.

# Part V: Reflection Questions

## Question 1: What have you learned about your data?

Several patterns emerged from these visualizations:

**Pattern 1: Geographic concentration** (Visualization 2). A few countries dominate hydropower production, with China and Brazil leading. This concentration means environmental impacts are geographically focused, which is important for understanding where "low-hanging fruits" might be found.

**Pattern 2: Emissions relationship** (Visualization 3). Countries with higher hydropower share tend to have lower GHG emissions per capita. This supports Article 1's claim that hydropower reduces emissions compared to fossil fuels. However, this doesn't address Article 2's methane concern.

**Pattern 3: Energy mix context** (Visualization 4). Even in top hydropower countries, fossil fuels often dominate the energy mix. This shows hydropower is part of a larger energy system, not a complete replacement for fossil fuels.

**Pattern 4: Methane connection** (Visualization 5). There's a positive relationship between hydropower generation and methane emissions, but methane comes from many sources. This suggests Article 2's concern may be valid but needs reservoir-specific data to fully evaluate.

**Pattern 5: Temporal expansion** (Visualization 6). China's rapid growth suggests much recent capacity comes from new dams. Article 2 argues new reservoirs emit more methane initially, which supports my thesis framework distinguishing new vs. existing dams.

## Question 2: Progress on FPM #1 Questions

In FPM #1, I outlined questions about:
1. How hydropower emissions compare to other energy sources
2. Whether geographic/climatic factors affect hydropower sustainability
3. How to identify "least impact" hydropower projects

**Progress made:**

âœ… **Question 1 (Emissions comparison):** Visualization 3 and 4 address this. Countries with more hydropower tend to have lower emissions, supporting Article 1. However, Visualization 5 shows methane concerns from Article 2 may also be valid. The contradiction is real - both perspectives have merit depending on which emissions we're measuring.

âœ… **Question 2 (Geographic variation):** Visualizations 2, 3, and 5 show significant geographic variation. Top hydropower countries differ in their emissions profiles, suggesting location and dam characteristics matter. This supports my thesis that some dams are "low-hanging fruits" while others have higher impact.

ðŸ”„ **Question 3 (Identifying least-impact projects):** Visualization 6 provides preliminary evidence - countries with older, established hydropower (like Canada, Norway) may have lower-impact dams than countries with rapid recent expansion (like China). However, I need my thesis data (FhRED categorization) to fully answer this.

**New questions that emerged:**

- How do reservoir age and methane emissions relate? (Article 2's temporal concern)
- What's the trade-off between energy storage capacity and environmental impact?
- How do regional energy needs affect the "low-hanging fruit" calculation?

**Next steps:**

1. Integrate thesis data: Once I have FhRED data with sustainability categories, I can create visualizations showing capacity within each category.
2. Add temporal dimension: Create visualizations showing how reservoir age affects emissions.
3. Regional analysis: Break down by climate zone to understand biophysical drivers.

## Question 3: Anticipated Challenges

**Data wrangling challenges:**

1. **Data integration:** Combining multiple datasets with different temporal coverage and country naming conventions. Some countries may be missing from certain datasets.

2. **Missing data:** Many countries have missing values, especially for older years or smaller countries. I'll need to decide how to handle these (filter vs. impute).

3. **Scale mismatches:** Per capita data vs. total generation data require careful interpretation. I need to be clear about what I'm comparing.

**Visualization challenges:**

1. **Communicating nuance:** The core message - "it depends on which dams" - is complex. I need visualizations that show variation without overwhelming the audience.

2. **Multiple dimensions:** My analysis has geography, time, emissions type, and energy source. Showing all simultaneously without creating cluttered plots will be challenging.

3. **Accessibility:** Ensuring colorblind-friendly palettes and clear labels for a general audience.

**Potential solutions:**

- Use consistent country names across datasets (may need manual cleaning)
- Filter to countries with complete data for key analyses
- Create multiple simple visualizations rather than one complex plot
- Test color palettes with colorblind simulation tools
- Be transparent about data limitations in captions
